<h2>Map</h2>

<div class="marker" id="map" style="width: 100％; height: 400px;"></div>

<article id="map">
スポット絞り込み：
<%= form_with(model: @spot, url: spots_path, method: :get, local: true) do |form| %>
  <div class="spot_search">
    <% %w(休憩 グルメ コンビニ お手洗い 自動販売機).each.with_index do |tag, i| %>
    <label>
      <%= form.radio_button :spot_tag, tag %>
      <%= tag %>
    </label>
    <% end %>
    <%= submit_tag "Search", class: "btn btn-success" %>
  </div>
<% end %>
</article>

<article id="index">
  <div class="container">
    <div class="row">
      <section class="spots col-md-8">
        <h2>最近の投稿</h2>
        <div class="row">
          <% @spot.order(created_at: "DESC").first(4).each do |spot| %>
          <div class="content col-md-6">
            <h3><%= spot.spot_name %></h3>
            <p><%= link_to image_tag(spot.spot_photo.url), spot_path(spot.id) %></p>
            <p>住所：<%= spot.address %></p>
            <p>スポット情報：<%= spot.spot_infomation %></p>
            <p>投稿者：<%= spot.user.name %></p>
            <% unless spot.spot_tag.nil? %>
              <!-- 配列として格納されているspot_tagの"を削除して表示 -->
              <p>タグ：<%= spot.spot_tag.gsub(/"/, '') %></p>
            <% end %>
          </div>
          <% end %>
        </div>
      </section>

      <section class="spots col-md-4">
        <div>
          <h2 class="clearfix">いいね Top3</h2>
          <!-- ランキング用カウント変数を作成 -->
          <% runking = 1 %>
          <% @spot.order(like: "DESC").first(3).each do |spot| %>
            <p class="like_number">いいね数 No.<%= runking %> [いいね数：<%= spot.like %>]</p>
          <div class="content">
            <h3><%= spot.spot_name %></h3>
            <p><%= link_to image_tag(spot.spot_photo.url), spot_path(spot.id) %></p>
            <p>住所：<%= spot.address %></p>
            <p>スポット情報：<%= spot.spot_infomation %></p>
            <p>投稿者：<%= spot.user.name %></p>
            <% unless spot.spot_tag.nil? %>
              <!-- 配列として格納されているspot_tagの"を削除して表示 -->
              <p>タグ：<%= spot.spot_tag.gsub(/"/, '') %></p>
            <% end %>
          </div>
          <!-- ランキング用カウントに+1 -->
          <% runking += 1%>
          <% end %>
        </div>
      </section>
      <div id="page_top"><a href="#"></a>
    </div>
  </div>
</article>

<script>
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    markers = handler.addMarkers(<%= raw @hash.to_json %>);
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
    handler.getMap().setCenter(new google.maps.LatLng(38.681583, 137.957183));
    handler.getMap().setZoom(5);
  });
</script>
